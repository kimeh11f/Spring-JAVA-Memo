# 스프링MVC 

### MVC아키텍처

- 모델 : 프레젠테이션 계층의 구성요소 정보를 담는다.
- 뷰 : 화면 출력 로직을 담는다.  
- 컨트롤러 : 제어 로직을 담는다.  

세 가지 요소가 서로 협력해서 하나의 웹 요청을 처리하고 응답을 만들어낸다.

프론트 컨트롤러 패턴 : 중앙집중형 컨트롤러를 프레젠테이션 계층의 제일 앞에 둬서 서버로 들어오는 모든 요청을 먼저 받아서 처리하게 만든다.  
클라이언트가 보낸 요청을 받아서 공통적인 작업을 먼저 수행한 후에, 적절한 세부 컨트롤러로 작업을 위임해주고, 클라이언트에게 보낼 뷰를 선택해서 최종 결과를 생성하는 등의 작업을 수행한다.

### HTTP요청부터 HTTP응답까지의 과정
1. DispatcherServlet의 HTTP 요청 접수  
자바 서버의 서블릿 컨테이너는 HTTP프로토콜을 통해 들어오는 요청이 스프링의 DispatcherServlet에 할당된 것이라면, http 요청정보를 DispatcherServlet에 전달해준다.
예를 들어, web.xml에 다음과 같이 되어있다면
```
<servlet-mapping>
	<servlet-name>Spring MVC Dispatcher Servlet</servlet-name>
	<url-pattern>/app/*</url-pattern>
</servlet-mapping>
```
이 서블릿 매핑은 /app으로 시작하는 모든 요청을 스프링의 프론트 컨트롤러인 DispatcherServlet에게 할당해주는 것이다.
DispatcherServlet은 모든 요청에 대해 공통적으로 진행해야하는 전처리 작업이 등록된 것이 있다면 이를 먼저 수행한다. (보안, 파라미터 조작, 한글 디코딩 등)

2. DispatcherServlet에서 컨트롤러로 HTTP요청 위임  
DispatcherServlet은 URL이나 파라미터 정보, HTTP명령 등을 참고로 해서 어떤 컨트롤러에게 작업을 위임할지 결정한다. 컨트롤러를 선정하는 것은 DispatcherServlet의 핸들러 매핑 전략을 이용한다.
핸들러는 스프링에서 컨트롤러를 의미한다.(요청을 다룬다는 의미). 어떤 컨트롤러가 요청을 처리하게 할지를 결정했다면, 해당 컨트롤러 오브젝트의 메소드를 호출해서 실제로 웹 요청을 처리하는 작업을 위임할 차례다. DispatcherServlet은 어떤 종류의 오브젝트라도 컨트롤러로 사용할 수 있다. 다만, 제각각 다른 메소드와 포맷을 가진 컨트롤러를 알아서 호출하게 만들기 위하여 중간에 어댑터를 이용하여 호출한다.  
DispatcherServlet이 핸들러 어댑터에 웹 요청을 전달할 때는 모든 웹 요청정보가 담긴 HttpServletRequest 타입의 오브젝트를 전달해준다. 이를 어댑터가 적절히 변환해서 컨트롤러의 메소드가 받을 수 있는 파라미터로 변환해서 전달해준다. HttpServletResponse도 함께 전달해주는데, 드물지만 컨트롤러가 결과를 리턴값으로 돌려주는 대신 HttpServletResponse 오브젝트 안에 직접 넣어줄 수도 있기 때문이다.  

3. 컨트롤러의 역할
	- 사용자 요청 해석
	- 실제 비즈니스로직을 수행하도록 서비스계층 오브젝트에게 작업을 위임
	- 그 결과를 받아서 모델 생성
	- 어떤 뷰를 사용할지 결정
	- DispatcherServlet에 모델과 뷰 전달(컨트롤러가 뷰 오브젝트를 직접 리턴할 수도 있지만, 보통은 뷰의 논리적인 이름을 리턴해주면 DispatcherServlet의 전략인 뷰 리졸버가 이를 이용해 뷰 오브젝트를 생성해준다.) 스프링의 ModelAndView라는 오브젝트가 DispatcherServlet이 최종적으로 어댑터를 통해 컨트롤러로부터 돌려받는 오브젝트다.

4. DispatcherServlet의 뷰 호출
DispatcherServlet은 컨트롤러로부터 모델과 뷰를 받은 뒤, 뷰 오브젝트에게 모델을 전달해주고 클라이언트에게 돌려줄 최종결과물을 생성해달라고 요청한다.  
보통은 브라우저에서 나타날 HTML을 생성하는 일이 가장 흔한 뷰의 작업이다.  
JSP를 이용해서 결과물을 만들어주는 JstlView는 컨트롤러가 돌려준 JSP 뷰 템플릿의 이름을 가져다 HTML을 생성한다. 그 중에 동적으로 생성되도록 표시된 부분은 모델의 내용을 참고로 해서 내용을 채워준다. 예를들어, Jstl은 JSP에서 다음과 같은 내용을 만나면 모델의 name에 해당하는 값을 가져와 ${name}자리에 대신 넣어준다. 뷰 작업을 통한 최종 결과물은 HttpServletResponse 오브젝트 안에 담긴다. 
```
<div>이름 : ${name} </div>
```  
5. HTTP 응답 돌려주기
뷰 생성까지의 모든 작업을 마쳤으면 DispatcherServlet은 등록된 후처리기가 있는지 확인하고, 있다면 후처리기에서 후속 작업을 진행한 뒤에 뷰가 만들어준 HttpServletResponse에 담긴 최종 결과를 서블릿 컨테이너에게 돌려준다.  
서블릿컨테이너는 HttpServletResponse에 담긴 정보를 HTTP 응답으로 만들어 사용자의 브라우저나 클라이언트에게 전송하고 작업을 종료한다.
